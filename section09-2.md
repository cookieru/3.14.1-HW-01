[<< Вернуться к оглалению](README.md) | [^ Ветвление в Git](section09.md)

[< Предыдущий раздел](section09-1.md)

Ветвление и слияние
===================

Как уже было сказано, если что-то мешает мешает команде `git checkout` сменить ветку она это не сделает. Одна из таких помех - это непроиндексированные изменения. Перед сменой ветки их необходимо либо закоммитить, либо припрятать. 

![пример вывода при непроиндексированных изменениях]()

Сейчас мы их закоммитим в предыдущий коммит с помощью параметров __--amend -a__. Второй способ рассматривать в этом руководстве мы не будем. 


Команда git merge. Слияние "fast-forward"
-----------------------------------------

Представим ситуацию. Мы находиимся на ветке ___testing___ и делаем, допустим, новые функции для нашей программы. Но вдруг в ветке ___main___ была обнаружена проблема, которую надо решить сейчас. Мы оставляем работу над веткой ___testing___, переходим в ветку ___main___ и создаем новую ветку ___hotfix___, в которой будем устранять эту проблему, и переключимся на нее

![весь абзац выше повторить в терминале]()

Когда закончим работу над ошибкой добавим изменения в ___main___, путем слияния веток. Для этого есть команда `git merge`:

![результат git merge слияние первой ветки]()

Git выполняет «fast-forward» слияние, когда последний коммит ветки, которую вы хотите слить, является прямым потомком последнего коммита ветки, в которую вы хотите слить. В этом случае Git просто перемещает указатель ветки вперед без создания нового коммита слияния. Поскольку изменения в ветке, которую вы хотите слить, не противоречат изменениям в целевой ветке, такое слияние происходит без каких-либо конфликтов и автоматически обновляет историю изменений сливаемой ветки для соответствия целевой ветке. Это удобно, потому что упрощает процесс слияния и сохраняет линейность истории коммитов.

Кстати, работу над ошибкой мы закончили и ветка ___hotfix___ нам больше не нужна. Ее можно без проблем удалить командой:

```
git branch -d hotfix
```

Команда git merge. Трехстороннее слияние
-----------------------------------------

После устранения ошибки мы вернулись в нашу ветку ___testing___ для продолжения работы над новым функционалом. Но перед этим "подтянули" изменения из ветки ___main___ после слияния с ___hotfix___. 

![результат git merge]()

Результат данной операции отличается от результата слияния ветки ___hotfix___. В данном случае, процесс разработки отклонился в более ранней точке. Поскольку коммит, на котором мы находимся, не является прямым родителем ветки, с которой мы выполняем слияние, Git должен проявить некоторые усилия. В таком случае Git выполняет трёхстороннее слияние, используя последние коммиты объединяемых веток и общий для них родительский коммит. Вместо простого перемещения указателя ветки вперед, Git создает новый результативный снимок трёхстороннего слияния, а затем автоматически выполняет коммит. Этот особый коммит называется коммитом слияния, так как у него более одного родителя.

Конфликты слияния
-----------------

В Git иногда возникают конфликты при слиянии веток, когда одна и та же часть файла была изменена по-разному в двух ветках. Это происходит, например, если вы внесли изменения в файл в ветке "hotfix", а затем в ветке "testing" внесли изменения в ту же самую часть файла. В таком случае Git не может автоматически слить эти изменения и останавливает процесс слияния, сообщая о конфликте.
Чтобы узнать, какие файлы содержат неразрешенные конфликты, вы можете выполнить команду "git status". Все файлы с конфликтами будут перечислены как "не слитые".

![результат git status]()

Чтобы разрешить конфликт, вам нужно вручную изменить конфликтующие файлы. Когда появляется конфликт, Git добавляет специальные маркеры конфликтов в файлы. Версия файла из ветки "main" (которую вы выбрали при выполнении команды слияния) находится в верхней части блока (все, что находится выше строки "======="). Версия файла из ветки "testing" представлена в нижней части блока. Вам нужно выбрать одну из версий или объединить содержимое по-своему усмотрению.

```
<<<<<<< HEAD
some fixes in hotfix
=======
some fixes in hotfix

some additions in testing
>>>>>>> testing
```

После того, как вы разрешили все конфликты и добавили измененные файлы в индекс, вы можете выполнить команду "git commit" для создания коммита слияния. Это зафиксирует слияние в истории репозитория.

![git commit -m "merge branch"]()

[<< Вернуться к оглалению](README.md) | [^ Ветвление в Git](section09.md)

[< Предыдущий раздел](section09-1.md)